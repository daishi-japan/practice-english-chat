# 英語学習チャットシステム 要件定義書

## 1. システム概要

### 1.1 目的

Geminiのようなチャットインターフェースを通じ、ユーザーが学びたい内容に対してAIが最適な英語フレーズを提案・学習できる環境を提供する。

### 1.2 コンセプト

**「1つの問いに、3つの答えを」**
ユーザーの入力に対し、AIがニュアンスの異なる3つの表現（例：フォーマル、カジュアル、ネイティブ表現など）を提示することで、実践的な英語力を養う。

---

## 2. 機能要件 (Functional Requirements)

### 2.1 チャット機能

* **システム開始時の挙動:**
* チャット画面を開いた際、AIから学習を促す挨拶メッセージ（例：「今日はどのようなシチュエーションの英語を学びたいですか？」）を自動送信する。


* **ユーザー入力:**
* ユーザーはテキストで学びたい内容（日本語または英語）を入力・送信できる。


* **AI応答（3つの吹き出し）:**
* ユーザーの入力に対し、AIは**3つの異なるメッセージ（フレーズ）**を生成し、連続して返信する。
* 各メッセージは独立した吹き出しとして表示される。



### 2.2 学習サポート機能（各吹き出し内）

AIからの返信メッセージ（吹き出し）には、以下の機能ボタンを配置する。

* **音声再生機能（音声アイコン）:**
* アイコン押下時、その吹き出し内の英文を読み上げる（Text-to-Speech）。


* **ブックマーク保存機能（ブックマークアイコン）:**
* アイコン押下時、そのフレーズを「ブックマーク一覧」に保存する。
* 保存済みの場合はアイコンの色を変更し、再押下で保存解除（トグル動作）とする。



### 2.3 ブックマーク管理機能

* **一覧表示:**
* 保存されたフレーズをリスト形式で閲覧できる画面を提供する。


* **削除機能:**
* 一覧から特定のフレーズを削除できる。
* **削除時の確認（モーダル）:**
* 削除ボタン押下時、即座に削除せず確認用モーダルウィンドウを表示する。
* モーダル内の「削除する」ボタン押下でのみ、データが削除される。





---

## 3. 画面・UI要件 (UI/UX Requirements)

### 3.1 画面構成

アプリは主に以下の2画面＋モーダルで構成する。

| 画面ID | 画面名 | 概要 |
| --- | --- | --- |
| **S01** | チャット画面 (Main) | メインの学習画面。下部に入力エリア、上部にチャット履歴。ヘッダー等からS02へ遷移可能。 |
| **S02** | ブックマーク一覧画面 | 保存したフレーズのリスト表示。削除ボタン配置。 |
| **M01** | 削除確認モーダル | S02で削除操作時にオーバーレイ表示。 |

### 3.2 詳細UI仕様

#### **S01: チャット画面**

* **レイアウト:** 一般的なチャットアプリ（Gemini, LINE等）に準拠。
* **AIメッセージバブルの構成:**
* 上段：英語フレーズテキスト
* 下段（アクションエリア）：
* 🔊 **音声アイコン:** 左寄せ
* 🔖 **ブックマークアイコン:** 右寄せ


* **3連送の仕様:** ユーザーの1入力に対し、少しのタイムラグ（自然な会話感）を持たせて3つのバブルを順次表示する。



#### **S02: ブックマーク一覧画面**

* **リスト要素の構成:**
* 保存した英語フレーズ
* 音声アイコン（ここでも聞けるようにする）
* 削除ボタン（ゴミ箱アイコンなど）



#### **M01: 削除確認モーダル**

* **メッセージ:** 「このフレーズをブックマークから削除しますか？」
* **アクション:**


---

## 4. データ要件 (Data Requirements)

システムで保持すべき最小限のデータ構造案。

### 4.1 Users (ユーザー)
* **概要:** アプリケーション上のユーザープロフィール情報。Supabase Authと連携する。
* **主要項目:**
    * UserID (PK): Supabase AuthのUIDと共通
    * Username
    * CreatedAt

### 4.2 ChatMessages (チャット履歴)
* **概要:** ユーザーとAIの対話ログ。「1つの問いに3つの答え」を実現するための構造を持つ。
* **主要項目:**
    * MessageID (PK)
    * UserID (FK)
    * ParentMessageID (FK): どのユーザー発言に対する回答かを紐付ける
    * Sender: 'USER' または 'AI'
    * ResponseType: AI回答の種類（Formal, Casual等）
    * Content: メッセージ本文
    * CreatedAt

### 4.3 Bookmarks (ブックマーク)
* **概要:** ユーザーが保存したフレーズ。元の文脈を辿れるようにする。
* **主要項目:**
    * BookmarkID (PK)
    * UserID (FK)
    * SourceMessageID (FK): 元のメッセージID
    * Phrase: 保存した英語フレーズ
    * Meaning: 日本語訳・解説など
    * CreatedAt

---

## 5. 技術スタック (Tech Stack)

本システム開発においては、以下の技術スタックを採用する。

* **フレームワーク:** Next.js
    * フロントエンドおよびBFF（Backend for Frontend）として利用。
* **バックエンド基盤 (BaaS):** Supabase
    * **Auth:** ユーザー認証機能として利用。
    * **Database:** アプリケーションデータ（ユーザー、チャット履歴、ブックマーク）の永続化。
    * **API:** フロントエンドからのデータアクセスおよびリアルタイム通信等に利用。
* **AI SDK:** ai-sdk (Vercel AI SDK)
    * AIモデルとの通信、ストリーミングレスポンスのハンドリングに利用。
* **デプロイメント:** Vercel
    * アプリケーションのホスティングおよびCI/CD環境。

---

## 6. 今後の検討事項（Next Steps）

開発を進めるにあたり、以下の詳細仕様や設定値を決定する必要がある。

1. **使用するAIモデルの特定:** ai-sdk経由で利用する具体的なモデル（例: OpenAI GPT-4o, Google Gemini Proなど）の選定とコスト試算。
2. **音声合成エンジン:** Web Speech API（ブラウザ標準）を使うか、外部API（OpenAI Audio API, Google Cloud TTS等）を使うかの決定。
3. **3つのバブルの性格付け:** 「フォーマル・カジュアル・スラング」にするか、「類似表現3選」にするかなど、システムプロンプトの詳細設計。